<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Secuencial</title>

<style>
body {
  margin: 0;
  height: 100vh;
  background: #0f0f0f;
  color: #fff;
  font-family: Arial, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ---------- GENERALES ---------- */
.screen {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

.screen.active {
  display: flex;
}

/* ---------- ANAGRAMA ---------- */
#word {
  display: flex;
  gap: 10px;
}

.letter {
  width: 60px;
  height: 60px;
  background: #1e88e5;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
}

.letter.selected {
  outline: 3px solid #fff;
}

#error {
  color: #e53935;
  display: none;
}

/* ---------- UNBLOCK ---------- */
#board {
  position: relative;
  width: 360px;
  height: 360px;
  background: #222;
  border-radius: 14px;
}

.block {
  position: absolute;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  touch-action: none;
}

.red { background: #e53935; }
.blue { background: #1e88e5; }
.yellow { background: #fbc02d; color:#000; }

#win {
  display: none;
  text-align: center;
}

a {
  color: #4fc3f7;
  font-size: 18px;
}
</style>
</head>

<body>

<!-- ========== ANAGRAMA ========== -->
<div id="anagram" class="screen active">
  <h2>ConfiguraciÃ³n incompleta</h2>
  <p>Reordena lo necesario para construir el escenario</p>

  <div id="word"></div>
  <button id="confirm">Confirmar</button>
  <div id="error">Orden incorrecto</div>
</div>

<!-- ========== UNBLOCK ========== -->
<div id="unblock" class="screen">
  <h2>Saca el bloque rojo âžœ</h2>
  <div id="board"></div>

  <div id="win">
    <h3>Puzzle resuelto ðŸ§ </h3>
    <a href="https://youtube.com/watch?v=UlKgy3loYr0&feature=shared" target="_blank">
      Ir al premio
    </a>
  </div>
</div>

<script>
/* ========== ANAGRAMA ========== */
const startWord = "NECESARIO";
const targetWord = "ESCENARIO";
let letters = startWord.split("");
let selected = null;

const wordDiv = document.getElementById("word");
const errorDiv = document.getElementById("error");

function renderWord() {
  wordDiv.innerHTML = "";
  letters.forEach((l, i) => {
    const el = document.createElement("div");
    el.className = "letter";
    el.textContent = l;
    if (i === selected) el.classList.add("selected");
    el.onclick = () => {
      if (selected === null) selected = i;
      else {
        [letters[selected], letters[i]] = [letters[i], letters[selected]];
        selected = null;
      }
      renderWord();
    };
    wordDiv.appendChild(el);
  });
}

document.getElementById("confirm").onclick = () => {
  if (letters.join("") === targetWord) {
    document.getElementById("anagram").classList.remove("active");
    document.getElementById("unblock").classList.add("active");
    initBlocks();
  } else {
    errorDiv.style.display = "block";
  }
};

renderWord();

/* ========== UNBLOCK TOUCH ========== */
const board = document.getElementById("board");
const win = document.getElementById("win");
const size = 60;

const blocks = [
  {id:"R",x:1,y:2,w:2,h:1,c:"red"},
  {id:"A",x:0,y:0,w:2,h:1,c:"blue"},
  {id:"B",x:3,y:0,w:2,h:1,c:"blue"},
  {id:"C",x:2,y:1,w:1,h:2,c:"yellow"},
  {id:"D",x:4,y:1,w:1,h:2,c:"yellow"},
  {id:"E",x:0,y:4,w:2,h:1,c:"blue"},
  {id:"F",x:3,y:4,w:2,h:1,c:"blue"}
];

function initBlocks() {
  board.innerHTML = "";
  blocks.forEach(b => {
    const el = document.createElement("div");
    el.className = `block ${b.c}`;
    el.style.width = b.w * size + "px";
    el.style.height = b.h * size + "px";
    el.style.left = b.x * size + "px";
    el.style.top = b.y * size + "px";
    el.textContent = b.id === "R" ? "â–¶" : "";
    board.appendChild(el);

    let startX, startY;

    el.addEventListener("pointerdown", e => {
      startX = e.clientX;
      startY = e.clientY;
      el.setPointerCapture(e.pointerId);
    });

    el.addEventListener("pointermove", e => {
      if (startX == null) return;
      let dx = e.clientX - startX;
      let dy = e.clientY - startY;

      if (b.w > b.h) dy = 0; else dx = 0;

      const nx = Math.round((b.x * size + dx) / size);
      const ny = Math.round((b.y * size + dy) / size);

      if (canMove(b, nx, ny)) {
        b.x = nx;
        b.y = ny;
        el.style.left = b.x * size + "px";
        el.style.top = b.y * size + "px";
        checkWin();
      }
    });

    el.addEventListener("pointerup", () => {
      startX = startY = null;
    });
  });
}

function canMove(b, nx, ny) {
  if (nx < 0 || ny < 0 || nx + b.w > 6 || ny + b.h > 6) return false;
  return !blocks.some(o =>
    o !== b &&
    nx < o.x + o.w &&
    nx + b.w > o.x &&
    ny < o.y + o.h &&
    ny + b.h > o.y
  );
}

function checkWin() {
  const r = blocks.find(b => b.id === "R");
  if (r.x + r.w === 6) {
    board.style.display = "none";
    win.style.display = "block";
  }
}
</script>

</body>
</html>
